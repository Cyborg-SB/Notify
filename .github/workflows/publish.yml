name: publish to nuget
on:
  push:
    branches:
      - main # Default release branch, may also be named 'master' or 'develop'
      
env: 
  PROJECT_PATH: Notify/Notify.csproj
  PACAGE_OUTPUT_PATH: ${{github.workspace}}\output
  NUGET_SOURCE_URL: https://api.nuget.org/v3/index.json


jobs:
  publish:
    name: build, pack & publish
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup .NET
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: 6.0.x

      - name: Restore packages
        run: dotnet restore ${{env.PROJECT_PATH}}

      - name: Build
        run: dotnet build ${{env.PROJECT_PATH}} --no-restore --configuration Release
        
      - name: Pack
        run: dotnet pack ${{env.PROJECT_PATH}} --no-restore --no-build --configuration Release --include-symbols --output ${{PACAGE_OUTPUT_PATH}}

      - name: Push package to nuget
        run: dotnet nuget push ${{PACAGE_OUTPUT_PATH}}\Notify*.nupkg -k ${{secrets.NUGET_KEY}} -s ${{env.NUGET_SOURCE_URL}}
        

